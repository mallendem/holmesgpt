{{- if or (.Values.toolsets | not | empty) .Values.mcpAddons.aws.enabled .Values.mcpAddons.mariadb.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: custom-toolsets-configmap
  namespace: {{ .Release.Namespace }}
data:
  custom_toolset.yaml: |-
    toolsets: {{ toYaml .Values.toolsets | nindent 6 }}
    {{- $mcpServers := .Values.mcp_servers }}
    {{- if .Values.mcpAddons.aws.enabled }}
    {{- $awsMcpServers := dict "aws_api" (dict
        "description" "AWS API MCP Server - comprehensive AWS service access. Allow executing any AWS CLI commands."
        "url" (printf "http://%s-aws-mcp-server.%s.svc.cluster.local:8000" .Release.Name (.Values.mcpAddons.aws.config.namespace | default .Release.Namespace))
        "llm_instructions" (include "holmes.awsMcp.llmInstructions" . | trim)
      )
    }}
    {{- $mcpServers = merge $mcpServers $awsMcpServers }}
    {{- end }}
    {{- if .Values.mcpAddons.mariadb.enabled }}
    {{- $mariadbMcpServers := dict "mariadb" (dict
        "description" "MariaDB database troubleshooting and monitoring MCP server"
        "config" (dict
          "url" (printf "http://%s-mariadb-mcp-server.%s.svc.cluster.local:8000/mcp" .Release.Name (.Values.mcpAddons.mariadb.config.namespace | default .Release.Namespace))
          "mode" "streamable-http"
          "headers" (dict "Content-Type" "application/json")
        )
        "llm_instructions" (include "holmes.mariadbMcp.llmInstructions" . | trim)
      )
    }}
    {{- $mcpServers = merge $mcpServers $mariadbMcpServers }}
    {{- end }}
    mcp_servers: {{ toYaml $mcpServers | nindent 6 }}
  model_list.yaml: |-
    {{ .Values.modelList | toYaml | nindent 4 }}

{{- end }}
