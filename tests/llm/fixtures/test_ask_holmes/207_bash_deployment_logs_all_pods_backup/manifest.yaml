apiVersion: v1
kind: Service
metadata:
  name: order-processor
  namespace: app-205
spec:
  clusterIP: None
  selector:
    app: order-processor
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: order-processor
  namespace: app-205
spec:
  serviceName: order-processor
  replicas: 30
  podManagementPolicy: Parallel
  selector:
    matchLabels:
      app: order-processor
  template:
    metadata:
      labels:
        app: order-processor
    spec:
      containers:
        - name: logger
          image: busybox:1.36
          command: ["/bin/sh", "-c"]
          args:
            - |
              POD_ID=$(hostname)
              i=0
              # Pod 27 has a different error message
              if [ "$POD_ID" = "order-processor-27" ]; then
                ERROR_MSG="ERROR: Database connection refused from $POD_ID"
              else
                ERROR_MSG="ERROR: Connection timeout from $POD_ID"
              fi
              # Burst phase: generate 5000 logs quickly (5% errors)
              # 30 pods × 5000 = 150K logs (~12MB) - too much for LLM to read all
              # But 30 pods × 250 errors = 7500 error logs (~600KB) - manageable with grep
              while [ $i -lt 5000 ]; do
                i=$((i+1))
                if [ $((i % 20)) -eq 0 ]; then
                  echo "$ERROR_MSG"
                else
                  echo "INFO: Processing request from $POD_ID"
                fi
              done
              # Steady phase: slower logs
              while true; do
                i=$((i+1))
                if [ $((i % 20)) -eq 0 ]; then
                  echo "$ERROR_MSG"
                else
                  echo "INFO: Processing request from $POD_ID"
                fi
                sleep 5
              done
          resources:
            limits:
              memory: "32Mi"
              cpu: "10m"
