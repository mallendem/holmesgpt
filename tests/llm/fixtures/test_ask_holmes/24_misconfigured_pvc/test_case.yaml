user_prompt: "What is the issue with redis?"
expected_output:
  - The PersistentVolumeClaim (pvc) is misconfigured
tags:
  - easy
  - kubernetes
  - regression
description: 'This test now verifies that the llm does not ask for clarification about what redis is and where to find it. test 80_pvc_storage_class_mismatch checks for the correct answer.'
before_test: |
  kubectl create namespace app-24 || true
  kubectl apply -f manifest.yaml -n app-24
  
  # Wait for specific ProvisioningFailed event
  PROVISIONING_FAILED=false
  for i in {1..60}; do
    if kubectl get events -n app-24 --field-selector involvedObject.name=redis-standard-pvc | grep -q "ProvisioningFailed"; then
      echo "✅ ProvisioningFailed event detected"
      PROVISIONING_FAILED=true
      break
    fi
    sleep 1
  done
  
  if [ "$PROVISIONING_FAILED" = false ]; then
    echo "❌ ProvisioningFailed event not detected"
    kubectl describe pvc redis-standard-pvc -n app-24  # Diagnostic info
    kubectl get events -n app-24  # Show all events for debugging
    exit 1  # CRITICAL: Fail the test early
  fi
after_test: |
  kubectl delete -f manifest.yaml -n app-24
  kubectl delete namespace app-24 || true
